<!DOCTYPE html>
<html lang="zh-us">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:site_name" content="XFDZ&#39;s Blog">
    <meta property="og:type" content="article">

    
    <meta property="og:image" content="https://xfdzcoder.github.io//https://cdn.jsdelivr.net/gh/zrgzs/images@main/images/2024%2F07%2F31%2F08-09-22-5598d9e07b8da240227832543a6ad424-f7f79d10f2667c22055e2bdff4da17ee-f65e0b.jpg">
    <meta property="twitter:image" content="https://xfdzcoder.github.io//https://cdn.jsdelivr.net/gh/zrgzs/images@main/images/2024%2F07%2F31%2F08-09-22-5598d9e07b8da240227832543a6ad424-f7f79d10f2667c22055e2bdff4da17ee-f65e0b.jpg" />
    

    
    <meta name="title" content="SpringMVC中整合的Jackson从请求体解析参数流程的源码分析" />
    <meta property="og:title" content="SpringMVC中整合的Jackson从请求体解析参数流程的源码分析" />
    <meta property="twitter:title" content="SpringMVC中整合的Jackson从请求体解析参数流程的源码分析" />
    

    
    <meta name="description" content="xfdzcoder">
    <meta property="og:description" content="xfdzcoder" />
    <meta property="twitter:description" content="xfdzcoder" />
    

    
    <meta property="twitter:card" content="summary" />
    
    

    <meta name="keyword"  content="xfdz, 个人网站, 互联网, Web, 云原生, 微服务, Java">
    <link rel="shortcut icon" href="/img/favicon.ico">

    <title>SpringMVC中整合的Jackson从请求体解析参数流程的源码分析 | XFDZ Blog</title>

    <link rel="canonical" href="/7224237482966319105/">

    
    
    
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    
    <link rel="stylesheet" href="/css/hugo-theme-cleanwhite.min.css">

    
    <link rel="stylesheet" href="/css/zanshang.css">

    
    <link rel="stylesheet" href="/css/font-awesome.all.min.css">

    
    

    
    <script src="/js/jquery.min.js"></script>

    
    <script src="/js/bootstrap.min.js"></script>

    
    <script src="/js/hux-blog.min.js"></script>

    
    <script src="/js/lazysizes.min.js"></script>

    
    

</head>






<nav class="navbar navbar-default navbar-custom navbar-fixed-top">

    <div class="container-fluid">
        
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href='/'>XFDZ&#39;s Blog</a>
        </div>

        
        
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">

                    <li>
                        <a style="color: black" href="/tags/top">置顶</a>
                    </li>

                    
                        
                        <li>
                            <a style="color: black" href="/categories/guide/">guide</a>
                        </li>
                        
                        <li>
                            <a style="color: black" href="/categories/java/">java</a>
                        </li>
                        
                        <li>
                            <a style="color: black" href="/categories/%E5%85%B6%E4%BB%96/">其他</a>
                        </li>
                        
                        <li>
                            <a style="color: black" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a>
                        </li>
                        
                        <li>
                            <a style="color: black" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a>
                        </li>
                        
                        <li>
                            <a style="color: black" href="/categories/%E6%A1%86%E6%9E%B6/">框架</a>
                        </li>
                        
                        <li>
                            <a style="color: black" href="/categories/%E9%9D%A2%E8%AF%95/">面试</a>
                        </li>
                        
                    

                    
                        <li><a style="color: black" href="/archive/">归档</a></li>
                    
                        <li><a style="color: black" href="/about/">关于</a></li>
                    
		            <li>
                        <a href="/search"><i class="fa fa-search" style="color: black"></i></a>
		           </li>
                </ul>
            </div>
        </div>
        
    </div>
    
</nav>
<script>
    
    
    
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        
            $navbar.className = " ";
            
            setTimeout(function(){
                
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>




<style type="text/css">
    header.intro-header {
        background-image: url('https://cdn.jsdelivr.net/gh/zrgzs/images@main/images/2024%2F07%2F31%2F08-09-22-5598d9e07b8da240227832543a6ad424-f7f79d10f2667c22055e2bdff4da17ee-f65e0b.jpg')
    }
</style>

<header class="intro-header" >

    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <div class="tags">
                        
                        <a class="tag" href="/tags/top" title="top">
                            top
                        </a>
                        
                        <a class="tag" href="/tags/ssm" title="ssm">
                            ssm
                        </a>
                        
                    </div>
                    <h1>SpringMVC中整合的Jackson从请求体解析参数流程的源码分析</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
                            Posted by 
                            
                                    XFDZ&#39;s Blog
                             
                            on 
                            Friday, March 22, 2024
                            
                            
                            
                            
                    </span>
                </div>
            </div>
        </div>
    </div>
</header>




<article>
    <div class="container">
        <div class="row">

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                
                <h1 id="springmvc中整合的jackson从请求体解析参数流程的源码分析">SpringMVC中整合的Jackson从请求体解析参数流程的源码分析</h1>
<p>环境：</p>
<p>springboot: 2.7.6</p>
<p>废话不多写，发车了。</p>
<p>还是从老熟人<code>DispatcherServlet</code> 的<code>doDispatch</code> 方法里的 <code>mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</code>说起</p>
<p>
  <img src="https://cdn.jsdelivr.net/gh/zrgzs/images@main/images/2024%2F07%2F31%2F11-16-43-fa9c94d2770679dfce965f4b0ffea9d5-202301052342717-c27b8f.png" alt="image-20221212223153973">

</p>
<p>然后进入到<code>org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter#handle</code></p>
<p>
  <img src="https://cdn.jsdelivr.net/gh/zrgzs/images@main/images/2024%2F07%2F31%2F11-17-08-2a1bbb767dd189ad4d0479e549466685-202301052342432-44be7d.png" alt="image-20221212223552198">

</p>
<p>这里的实际逻辑是在一个由其子类实现的方法中：<code>org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter#handleInternal</code></p>
<p>
  <img src="https://cdn.jsdelivr.net/gh/zrgzs/images@main/images/2024%2F07%2F31%2F11-16-47-9dbd6516c49f1ae589296c89fa7d6ffc-202301052342079-65a486.png" alt="image-20221212223946853">

</p>
<p>这里大都是一样的，就不赘述了</p>
<p>
  <img src="SpringMVC%e4%b8%ad%e6%95%b4%e5%90%88%e7%9a%84Jackson%e4%bb%8e%e8%af%b7%e6%b1%82%e4%bd%93%e8%a7%a3%e6%9e%90%e5%8f%82%e6%95%b0%e6%b5%81%e7%a8%8b%e7%9a%84%e6%ba%90%e7%a0%81%e5%88%86%e6%9e%90.assets/image-20221212224040501.png" alt="image-20221212224040501">

</p>
<p>
  <img src="https://cdn.jsdelivr.net/gh/zrgzs/images@main/images/2024%2F07%2F31%2F11-16-49-1d6b09d71717add48e92afe68101dba2-202301052342095-f8a8f1.png" alt="image-20221212224100557">

</p>
<h2 id="正文">正文</h2>
<p>在<code>org.springframework.web.method.support.InvocableHandlerMethod#invokeForRequest</code>中会根据方法参数获取对应的值，然后携带着需要的参数进行调用。这就是我们要分析的，Jackson是如何做到的？</p>
<p>
  <img src="https://cdn.jsdelivr.net/gh/zrgzs/images@main/images/2024%2F07%2F31%2F11-16-52-b309da8b703b4b1eaefa90b7dd345330-202301052342473-ba24cf.png" alt="image-20221212224328373">

</p>
<p>其中获取参数值就是用这个方法：</p>
<h3 id="orgspringframeworkwebmethodsupportinvocablehandlermethodgetmethodargumentvalues"><code>org.springframework.web.method.support.InvocableHandlerMethod#getMethodArgumentValues</code></h3>
<p>源码如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	 * 获取当前请求的方法参数值，检查提供的参数值并返回到配置的参数解析器。 生成的数组将传递给doInvoke。 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	自: 5.1.2
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	 */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">protected</span> Object<span style="color:#ff79c6">[]</span> <span style="color:#50fa7b">getMethodArgumentValues</span>(NativeWebRequest request, @Nullable ModelAndViewContainer mavContainer,
</span></span><span style="display:flex;"><span>			Object... providedArgs) <span style="color:#8be9fd;font-style:italic">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// 获取参数列表</span>
</span></span><span style="display:flex;"><span>		MethodParameter<span style="color:#ff79c6">[]</span> parameters <span style="color:#ff79c6">=</span> getMethodParameters();
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// 如果参数列表为空则直接返回空参</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (ObjectUtils.<span style="color:#50fa7b">isEmpty</span>(parameters)) {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span> EMPTY_ARGS;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 新建一个数组用于存放参数</span>
</span></span><span style="display:flex;"><span>		Object<span style="color:#ff79c6">[]</span> args <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> Object<span style="color:#ff79c6">[</span>parameters.<span style="color:#50fa7b">length</span><span style="color:#ff79c6">]</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// 循环遍历每个参数</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> 0; i <span style="color:#ff79c6">&lt;</span> parameters.<span style="color:#50fa7b">length</span>; i<span style="color:#ff79c6">++</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 获取参数</span>
</span></span><span style="display:flex;"><span>			MethodParameter parameter <span style="color:#ff79c6">=</span> parameters<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span>;
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 初始化参数名称发现器（不知道是个啥）</span>
</span></span><span style="display:flex;"><span>			parameter.<span style="color:#50fa7b">initParameterNameDiscovery</span>(<span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">parameterNameDiscoverer</span>);
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 查找提供的参数</span>
</span></span><span style="display:flex;"><span>			args<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> findProvidedArgument(parameter, providedArgs);
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">if</span> (args<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">continue</span>;
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 判断是否有转换器支持处理该参数</span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span><span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">resolvers</span>.<span style="color:#50fa7b">supportsParameter</span>(parameter)) {
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> IllegalStateException(formatArgumentError(parameter, <span style="color:#f1fa8c">&#34;No suitable resolver&#34;</span>));
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// 使用转换器获取参数</span>
</span></span><span style="display:flex;"><span>				args<span style="color:#ff79c6">[</span>i<span style="color:#ff79c6">]</span> <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">resolvers</span>.<span style="color:#50fa7b">resolveArgument</span>(parameter, mavContainer, request, <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">dataBinderFactory</span>);
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">catch</span> (Exception ex) {
</span></span><span style="display:flex;"><span>				<span style="color:#6272a4">// Leave stack trace for later, exception may actually be resolved and handled...</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">if</span> (logger.<span style="color:#50fa7b">isDebugEnabled</span>()) {
</span></span><span style="display:flex;"><span>					String exMsg <span style="color:#ff79c6">=</span> ex.<span style="color:#50fa7b">getMessage</span>();
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">if</span> (exMsg <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span> <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!</span>exMsg.<span style="color:#50fa7b">contains</span>(parameter.<span style="color:#50fa7b">getExecutable</span>().<span style="color:#50fa7b">toGenericString</span>())) {
</span></span><span style="display:flex;"><span>						logger.<span style="color:#50fa7b">debug</span>(formatArgumentError(parameter, exMsg));
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">throw</span> ex;
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> args;
</span></span></code></pre></div><h3 id="orgspringframeworkwebmethodsupporthandlermethodargumentresolvercompositeresolveargument"><code>org.springframework.web.method.support.HandlerMethodArgumentResolverComposite#resolveArgument</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	对已注册的HandlerMethodArgumentResolver进行迭代，并调用支持它的HandlerMethod Argument解析器。 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	抛出: IllegalArgumentException–如果找不到合适的参数解析器
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	 */</span>
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	@Nullable
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> Object <span style="color:#50fa7b">resolveArgument</span>(MethodParameter parameter, @Nullable ModelAndViewContainer mavContainer,
</span></span><span style="display:flex;"><span>			NativeWebRequest webRequest, @Nullable WebDataBinderFactory binderFactory) <span style="color:#8be9fd;font-style:italic">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取转换器</span>
</span></span><span style="display:flex;"><span>		HandlerMethodArgumentResolver resolver <span style="color:#ff79c6">=</span> getArgumentResolver(parameter);
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> (resolver <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> IllegalArgumentException(<span style="color:#f1fa8c">&#34;Unsupported parameter type [&#34;</span> <span style="color:#ff79c6">+</span>
</span></span><span style="display:flex;"><span>					parameter.<span style="color:#50fa7b">getParameterType</span>().<span style="color:#50fa7b">getName</span>() <span style="color:#ff79c6">+</span> <span style="color:#f1fa8c">&#34;]. supportsParameter should be called first.&#34;</span>);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 开始转换</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 此处使用的是 org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor#resolveArgument</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> resolver.<span style="color:#50fa7b">resolveArgument</span>(parameter, mavContainer, webRequest, binderFactory);
</span></span></code></pre></div><h3 id="orgspringframeworkwebservletmvcmethodannotationrequestresponsebodymethodprocessorresolveargument"><code>org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor#resolveArgument</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	如果验证失败，则引发MethodArgumentNotValidException。 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	抛出: HttpMessageNotReadableException–如果RequestBody。required（）为true，并且没有正文内容，或者没有合适的转换器来读取内容
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	 */</span>
</span></span><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> Object <span style="color:#50fa7b">resolveArgument</span>(MethodParameter parameter, @Nullable ModelAndViewContainer mavContainer,
</span></span><span style="display:flex;"><span>			NativeWebRequest webRequest, @Nullable WebDataBinderFactory binderFactory) <span style="color:#8be9fd;font-style:italic">throws</span> Exception {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 如果参数是 Optional 类型则解除嵌套</span>
</span></span><span style="display:flex;"><span>		parameter <span style="color:#ff79c6">=</span> parameter.<span style="color:#50fa7b">nestedIfOptional</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 从消息转换其中读取参数</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 从此入</span>
</span></span><span style="display:flex;"><span>		Object arg <span style="color:#ff79c6">=</span> readWithMessageConverters(webRequest, parameter, parameter.<span style="color:#50fa7b">getNestedGenericParameterType</span>());
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> adaptArgumentIfNecessary(arg, parameter);
</span></span></code></pre></div><h3 id="orgspringframeworkwebservletmvcmethodannotationrequestresponsebodymethodprocessorreadwithmessageconverters"><code>org.springframework.web.servlet.mvc.method.annotation.RequestResponseBodyMethodProcessor#readWithMessageConverters</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	@Override
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">protected</span> <span style="color:#ff79c6">&lt;</span>T<span style="color:#ff79c6">&gt;</span> Object <span style="color:#50fa7b">readWithMessageConverters</span>(NativeWebRequest webRequest, MethodParameter parameter,
</span></span><span style="display:flex;"><span>			Type paramType) <span style="color:#8be9fd;font-style:italic">throws</span> IOException, HttpMediaTypeNotSupportedException, HttpMessageNotReadableException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		HttpServletRequest servletRequest <span style="color:#ff79c6">=</span> webRequest.<span style="color:#50fa7b">getNativeRequest</span>(HttpServletRequest.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>		Assert.<span style="color:#50fa7b">state</span>(servletRequest <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>, <span style="color:#f1fa8c">&#34;No HttpServletRequest&#34;</span>);
</span></span><span style="display:flex;"><span>		ServletServerHttpRequest inputMessage <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ServletServerHttpRequest(servletRequest);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 通过读取给定的HttpInputMessage，创建所需参数类型的方法参数值。</span>
</span></span><span style="display:flex;"><span>		Object arg <span style="color:#ff79c6">=</span> readWithMessageConverters(inputMessage, parameter, paramType);
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> arg;
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><h3 id="orgspringframeworkwebservletmvcmethodannotationabstractmessageconvertermethodargumentresolverreadwithmessageconvertersorgspringframeworkhttphttpinputmessage-orgspringframeworkcoremethodparameter-javalangreflecttype"><code>org.springframework.web.servlet.mvc.method.annotation.AbstractMessageConverterMethodArgumentResolver#readWithMessageConverters(org.springframework.http.HttpInputMessage, org.springframework.core.MethodParameter, java.lang.reflect.Type)</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	通过读取给定的HttpInputMessage，创建所需参数类型的方法参数值。 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	形参: 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">		inputMessage–表示当前请求参数的HTTP输入消息–方法参数描述符
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">		targetType–目标类型，不一定与方法参数类型相同，例如，对于HttpEntity 。 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	返回值: 创建的方法参数值 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	抛出: 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">		IOException–如果读取请求失败 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">		HttpMediaTypeNotSupportedException–如果找不到合适的消息转换器 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	*/</span>
</span></span><span style="display:flex;"><span>	@SuppressWarnings(<span style="color:#f1fa8c">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>	@Nullable
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">protected</span> <span style="color:#ff79c6">&lt;</span>T<span style="color:#ff79c6">&gt;</span> Object <span style="color:#50fa7b">readWithMessageConverters</span>(HttpInputMessage inputMessage, MethodParameter parameter,
</span></span><span style="display:flex;"><span>			Type targetType) <span style="color:#8be9fd;font-style:italic">throws</span> IOException, HttpMediaTypeNotSupportedException, HttpMessageNotReadableException {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		MediaType contentType;
</span></span><span style="display:flex;"><span>		<span style="color:#8be9fd">boolean</span> noContentType <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 获取请求头中的 ContentType</span>
</span></span><span style="display:flex;"><span>			contentType <span style="color:#ff79c6">=</span> inputMessage.<span style="color:#50fa7b">getHeaders</span>().<span style="color:#50fa7b">getContentType</span>();
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">catch</span> (InvalidMediaTypeException ex) {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> HttpMediaTypeNotSupportedException(ex.<span style="color:#50fa7b">getMessage</span>());
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 如果没有定义 ContentType 则默认为 application/octet-stream</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> (contentType <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>			noContentType <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span>			contentType <span style="color:#ff79c6">=</span> MediaType.<span style="color:#50fa7b">APPLICATION_OCTET_STREAM</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取参数的包含类对象（不知道是个啥）</span>
</span></span><span style="display:flex;"><span>		Class<span style="color:#ff79c6">&lt;?&gt;</span> contextClass <span style="color:#ff79c6">=</span> parameter.<span style="color:#50fa7b">getContainingClass</span>();
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// 获取要转换的目标对象</span>
</span></span><span style="display:flex;"><span>        Class<span style="color:#ff79c6">&lt;</span>T<span style="color:#ff79c6">&gt;</span> targetClass <span style="color:#ff79c6">=</span> (targetType <span style="color:#ff79c6">instanceof</span> Class <span style="color:#ff79c6">?</span> (Class<span style="color:#ff79c6">&lt;</span>T<span style="color:#ff79c6">&gt;</span>) targetType : <span style="color:#ff79c6">null</span>);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> (targetClass <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>			ResolvableType resolvableType <span style="color:#ff79c6">=</span> ResolvableType.<span style="color:#50fa7b">forMethodParameter</span>(parameter);
</span></span><span style="display:flex;"><span>			targetClass <span style="color:#ff79c6">=</span> (Class<span style="color:#ff79c6">&lt;</span>T<span style="color:#ff79c6">&gt;</span>) resolvableType.<span style="color:#50fa7b">resolve</span>();
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取请求方法</span>
</span></span><span style="display:flex;"><span>		HttpMethod httpMethod <span style="color:#ff79c6">=</span> (inputMessage <span style="color:#ff79c6">instanceof</span> HttpRequest <span style="color:#ff79c6">?</span> ((HttpRequest) inputMessage).<span style="color:#50fa7b">getMethod</span>() : <span style="color:#ff79c6">null</span>);
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// 初始化请求体</span>
</span></span><span style="display:flex;"><span>        Object body <span style="color:#ff79c6">=</span> NO_VALUE;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		EmptyBodyCheckingHttpInputMessage message <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>			message <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> EmptyBodyCheckingHttpInputMessage(inputMessage);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 遍历所有消息转换器</span>
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">for</span> (HttpMessageConverter<span style="color:#ff79c6">&lt;?&gt;</span> converter : <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">messageConverters</span>) {
</span></span><span style="display:flex;"><span>				Class<span style="color:#ff79c6">&lt;</span>HttpMessageConverter<span style="color:#ff79c6">&lt;?&gt;&gt;</span> converterType <span style="color:#ff79c6">=</span> (Class<span style="color:#ff79c6">&lt;</span>HttpMessageConverter<span style="color:#ff79c6">&lt;?&gt;&gt;</span>) converter.<span style="color:#50fa7b">getClass</span>();
</span></span><span style="display:flex;"><span>				GenericHttpMessageConverter<span style="color:#ff79c6">&lt;?&gt;</span> genericConverter <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>						(converter <span style="color:#ff79c6">instanceof</span> GenericHttpMessageConverter <span style="color:#ff79c6">?</span> (GenericHttpMessageConverter<span style="color:#ff79c6">&lt;?&gt;</span>) converter : <span style="color:#ff79c6">null</span>);
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// 判断标准转换器是否支持</span>
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// 从此入</span>
</span></span><span style="display:flex;"><span>				<span style="color:#ff79c6">if</span> (genericConverter <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span> <span style="color:#ff79c6">?</span> genericConverter.<span style="color:#50fa7b">canRead</span>(targetType, contextClass, contentType) :
</span></span><span style="display:flex;"><span>						(targetClass <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span> <span style="color:#ff79c6">&amp;&amp;</span> converter.<span style="color:#50fa7b">canRead</span>(targetClass, contentType))) {
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">if</span> (message.<span style="color:#50fa7b">hasBody</span>()) {
</span></span><span style="display:flex;"><span>						HttpInputMessage msgToUse <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>								getAdvice().<span style="color:#50fa7b">beforeBodyRead</span>(message, parameter, targetType, converterType);
</span></span><span style="display:flex;"><span>						body <span style="color:#ff79c6">=</span> (genericConverter <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span> <span style="color:#ff79c6">?</span> genericConverter.<span style="color:#50fa7b">read</span>(targetType, contextClass, msgToUse) :
</span></span><span style="display:flex;"><span>								((HttpMessageConverter<span style="color:#ff79c6">&lt;</span>T<span style="color:#ff79c6">&gt;</span>) converter).<span style="color:#50fa7b">read</span>(targetClass, msgToUse));
</span></span><span style="display:flex;"><span>						body <span style="color:#ff79c6">=</span> getAdvice().<span style="color:#50fa7b">afterBodyRead</span>(body, msgToUse, parameter, targetType, converterType);
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>						body <span style="color:#ff79c6">=</span> getAdvice().<span style="color:#50fa7b">handleEmptyBody</span>(<span style="color:#ff79c6">null</span>, message, parameter, targetType, converterType);
</span></span><span style="display:flex;"><span>					}
</span></span><span style="display:flex;"><span>					<span style="color:#ff79c6">break</span>;
</span></span><span style="display:flex;"><span>				}
</span></span><span style="display:flex;"><span>			}
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">catch</span> (IOException ex) {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> HttpMessageNotReadableException(<span style="color:#f1fa8c">&#34;I/O error while reading input message&#34;</span>, ex, inputMessage);
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> body;
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><h3 id="orgspringframeworkhttpconverterjsonabstractjackson2httpmessageconvertercanreadjavalangreflecttype-javalangclass-orgspringframeworkhttpmediatype"><code>org.springframework.http.converter.json.AbstractJackson2HttpMessageConverter#canRead(java.lang.reflect.Type, java.lang.Class&lt;?&gt;, org.springframework.http.MediaType)</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">canRead</span>(Type type, @Nullable Class<span style="color:#ff79c6">&lt;?&gt;</span> contextClass, @Nullable MediaType mediaType) {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 首先判断该媒体类型是否被支持</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>canRead(mediaType)) {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取 Java 类型</span>
</span></span><span style="display:flex;"><span>		JavaType javaType <span style="color:#ff79c6">=</span> getJavaType(type, contextClass);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 根据 Java 类型选择合适的 ObjectMapper</span>
</span></span><span style="display:flex;"><span>		ObjectMapper objectMapper <span style="color:#ff79c6">=</span> selectObjectMapper(javaType.<span style="color:#50fa7b">getRawClass</span>(), mediaType);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 如果没有合适的 ObjectMapper 则返回 null</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">if</span> (objectMapper <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>		AtomicReference<span style="color:#ff79c6">&lt;</span>Throwable<span style="color:#ff79c6">&gt;</span> causeRef <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> AtomicReference<span style="color:#ff79c6">&lt;&gt;</span>();
</span></span><span style="display:flex;"><span>		
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 判断 ObjectMapper 是否能够反序列化该类型</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 从此入</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (objectMapper.<span style="color:#50fa7b">canDeserialize</span>(javaType, causeRef)) {
</span></span><span style="display:flex;"><span>			<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">true</span>;
</span></span><span style="display:flex;"><span>		}
</span></span><span style="display:flex;"><span>		<span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>		<span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>	}
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabindobjectmappercandeserializecomfasterxmljacksondatabindjavatype-javautilconcurrentatomicatomicreferencejavalangthrowable"><code>com.fasterxml.jackson.databind.ObjectMapper#canDeserialize(com.fasterxml.jackson.databind.JavaType, java.util.concurrent.atomic.AtomicReference&lt;java.lang.Throwable&gt;)</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    方法类似于canDeserialize（JavaType），但它可以返回在尝试构造序列化程序时抛出的实际Throwable：这可能有助于确定实际问题是什么。 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    自: 2.3
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">canDeserialize</span>(JavaType type, AtomicReference<span style="color:#ff79c6">&lt;</span>Throwable<span style="color:#ff79c6">&gt;</span> cause)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 创建一个反序列化器上下文对象，然后判断是否有反序列化器可以反序列化该类型</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> createDeserializationContext(<span style="color:#ff79c6">null</span>,
</span></span><span style="display:flex;"><span>                getDeserializationConfig()).<span style="color:#50fa7b">hasValueDeserializerFor</span>(type, cause);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserializationcontexthasvaluedeserializerfor"><code>com.fasterxml.jackson.databind.DeserializationContext#hasValueDeserializerFor</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    方法，用于检查是否可以找到给定类型的反序列化程序。 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    形参: 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    	type–检查原因的类型–（可选）如果由于异常无法找到反序列化程序，则将引用设置为根本原因（以查找失败原因）
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    自: 2.3
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">hasValueDeserializerFor</span>(JavaType type, AtomicReference<span style="color:#ff79c6">&lt;</span>Throwable<span style="color:#ff79c6">&gt;</span> cause) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 从缓存中查找是否有反序列化器支持该类型</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> _cache.<span style="color:#50fa7b">hasValueDeserializerFor</span>(<span style="color:#ff79c6">this</span>, _factory, type);
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">catch</span> (DatabindException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (cause <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>                cause.<span style="color:#50fa7b">set</span>(e);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">catch</span> (RuntimeException e) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (cause <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) { <span style="color:#6272a4">// earlier behavior</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">throw</span> e;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            cause.<span style="color:#50fa7b">set</span>(e);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">false</span>;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserdeserializercachehasvaluedeserializerfor"><code>com.fasterxml.jackson.databind.deser.DeserializerCache#hasValueDeserializerFor</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    调用方法以确定提供程序是否能够使用根引用（即不通过数组或集合中的字段或成员身份）找到给定类型的反序列化程序
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    */</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">boolean</span> <span style="color:#50fa7b">hasValueDeserializerFor</span>(DeserializationContext ctxt,
</span></span><span style="display:flex;"><span>            DeserializerFactory factory, JavaType type)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">throws</span> JsonMappingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* Note: mostly copied from findValueDeserializer, except for
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         * handling of unknown types
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 从缓存中查找反序列化器</span>
</span></span><span style="display:flex;"><span>        JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span> deser <span style="color:#ff79c6">=</span> _findCachedDeserializer(type);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (deser <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 找不到则创建并缓存该反序列化器</span>
</span></span><span style="display:flex;"><span>            deser <span style="color:#ff79c6">=</span> _createAndCacheValueDeserializer(ctxt, factory, type);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> (deser <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserdeserializercache_createandcachevaluedeserializer"><code>com.fasterxml.jackson.databind.deser.DeserializerCache#_createAndCacheValueDeserializer</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	方法，该方法将尝试为给定类型创建反序列化程序，并在必要时对其进行解析和缓存 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	形参: 
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">		ctxt–当前活动的反序列化上下文类型–要反序列化的属性类型
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">protected</span> JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">_createAndCacheValueDeserializer</span>(DeserializationContext ctxt,
</span></span><span style="display:flex;"><span>            DeserializerFactory factory, JavaType type)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">throws</span> JsonMappingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* Only one thread to construct deserializers at any given point in time;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         * limitations necessary to ensure that only completely initialized ones
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         * are visible and used.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 加锁，防止重复创建反序列化器</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">synchronized</span> (_incompleteDeserializers) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// Ok, then: could it be that due to a race condition, deserializer can now be found?</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 双重检查，判断是否已经有线程创建好了反序列化器</span>
</span></span><span style="display:flex;"><span>            JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span> deser <span style="color:#ff79c6">=</span> _findCachedDeserializer(type);
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (deser <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> deser;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 判断是否有正在创建，但是尚未完全创建的反序列化器</span>
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd">int</span> count <span style="color:#ff79c6">=</span> _incompleteDeserializers.<span style="color:#50fa7b">size</span>();
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// Or perhaps being resolved right now?</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (count <span style="color:#ff79c6">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>                deser <span style="color:#ff79c6">=</span> _incompleteDeserializers.<span style="color:#50fa7b">get</span>(type);
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (deser <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">return</span> deser;
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// Nope: need to create and possibly cache</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// 创建并缓存反序列化器</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> _createAndCache2(ctxt, factory, type);
</span></span><span style="display:flex;"><span>            } <span style="color:#ff79c6">finally</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// also: any deserializers that have been created are complete by now</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (count <span style="color:#ff79c6">==</span> 0 <span style="color:#ff79c6">&amp;&amp;</span> _incompleteDeserializers.<span style="color:#50fa7b">size</span>() <span style="color:#ff79c6">&gt;</span> 0) {
</span></span><span style="display:flex;"><span>                    _incompleteDeserializers.<span style="color:#50fa7b">clear</span>();
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserdeserializercache_createandcache2"><code>com.fasterxml.jackson.databind.deser.DeserializerCache#_createAndCache2</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	处理实际构造（通过工厂）和缓存（中间和最终）的方法
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	*/</span>
</span></span><span style="display:flex;"><span>	<span style="color:#8be9fd;font-style:italic">protected</span> JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">_createAndCache2</span>(DeserializationContext ctxt,
</span></span><span style="display:flex;"><span>            DeserializerFactory factory, JavaType type)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">throws</span> JsonMappingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span> deser;
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 创建反序列化器</span>
</span></span><span style="display:flex;"><span>            deser <span style="color:#ff79c6">=</span> _createDeserializer(ctxt, factory, type);
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">catch</span> (IllegalArgumentException iae) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// We better only expose checked exceptions, since those</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// are what caller is expected to handle</span>
</span></span><span style="display:flex;"><span>            ctxt.<span style="color:#50fa7b">reportBadDefinition</span>(type, ClassUtil.<span style="color:#50fa7b">exceptionMessage</span>(iae));
</span></span><span style="display:flex;"><span>            deser <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span>; <span style="color:#6272a4">// never gets here</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// ...</span>
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserdeserializercache_createdeserializer"><code>com.fasterxml.jackson.databind.deser.DeserializerCache#_createDeserializer</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	方法，该方法负责检查每类型注释，找出完整类型，并找出要调用的实际工厂方法。
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	*/</span>
</span></span><span style="display:flex;"><span>	@SuppressWarnings(<span style="color:#f1fa8c">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">protected</span> JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">_createDeserializer</span>(DeserializationContext ctxt,
</span></span><span style="display:flex;"><span>            DeserializerFactory factory, JavaType type)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">throws</span> JsonMappingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取配置</span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">final</span> DeserializationConfig config <span style="color:#ff79c6">=</span> ctxt.<span style="color:#50fa7b">getConfig</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 首先，我们需要使用抽象类型映射吗？</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (type.<span style="color:#50fa7b">isAbstract</span>() <span style="color:#ff79c6">||</span> type.<span style="color:#50fa7b">isMapLikeType</span>() <span style="color:#ff79c6">||</span> type.<span style="color:#50fa7b">isCollectionLikeType</span>()) {
</span></span><span style="display:flex;"><span>            type <span style="color:#ff79c6">=</span> factory.<span style="color:#50fa7b">mapAbstractType</span>(config, type);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        BeanDescription beanDesc <span style="color:#ff79c6">=</span> config.<span style="color:#50fa7b">introspect</span>(type);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 那么：类型是否定义了要使用的显式反序列化程序以及注释？</span>
</span></span><span style="display:flex;"><span>        JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span> deser <span style="color:#ff79c6">=</span> findDeserializerFromAnnotation(ctxt,
</span></span><span style="display:flex;"><span>                beanDesc.<span style="color:#50fa7b">getClassInfo</span>());
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (deser <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> deser;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 如果没有，可能需要检查更多的类型修改注释：</span>
</span></span><span style="display:flex;"><span>        JavaType newType <span style="color:#ff79c6">=</span> modifyTypeByAnnotation(ctxt, beanDesc.<span style="color:#50fa7b">getClassInfo</span>(), type);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (newType <span style="color:#ff79c6">!=</span> type) {
</span></span><span style="display:flex;"><span>            type <span style="color:#ff79c6">=</span> newType;
</span></span><span style="display:flex;"><span>            beanDesc <span style="color:#ff79c6">=</span> config.<span style="color:#50fa7b">introspect</span>(newType);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 我们可能还需要考虑生成器类型。。。</span>
</span></span><span style="display:flex;"><span>        Class<span style="color:#ff79c6">&lt;?&gt;</span> builder <span style="color:#ff79c6">=</span> beanDesc.<span style="color:#50fa7b">findPOJOBuilder</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (builder <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> (JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span>) factory.<span style="color:#50fa7b">createBuilderBasedDeserializer</span>(
</span></span><span style="display:flex;"><span>            		ctxt, type, beanDesc, builder);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 或者是转换器？</span>
</span></span><span style="display:flex;"><span>        Converter<span style="color:#ff79c6">&lt;</span>Object,Object<span style="color:#ff79c6">&gt;</span> conv <span style="color:#ff79c6">=</span> beanDesc.<span style="color:#50fa7b">findDeserializationConverter</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (conv <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) { <span style="color:#6272a4">// 不，只是以正常方式构建</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 返回以正常方式构建的反序列化器</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> (JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span>) _createDeserializer2(ctxt, factory, type, beanDesc);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> StdDelegatingDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span>(conv, delegateType,
</span></span><span style="display:flex;"><span>                _createDeserializer2(ctxt, factory, delegateType, beanDesc));
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserdeserializercache_createdeserializer2"><code>com.fasterxml.jackson.databind.deser.DeserializerCache#_createDeserializer2</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">protected</span> JsonDeserializer<span style="color:#ff79c6">&lt;?&gt;</span> _createDeserializer2(DeserializationContext ctxt,
</span></span><span style="display:flex;"><span>            DeserializerFactory factory, JavaType type, BeanDescription beanDesc)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">throws</span> JsonMappingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">final</span> DeserializationConfig config <span style="color:#ff79c6">=</span> ctxt.<span style="color:#50fa7b">getConfig</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// If not, let&#39;s see which factory method to use</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 12-Feb-20202, tatu: Need to ensure that not only all Enum implementations get</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//    there, but also `Enum` -- latter wrt [databind#2605], polymorphic usage</span>
</span></span><span style="display:flex;"><span>    	<span style="color:#6272a4">// 判断是否为枚举类型    </span>
</span></span><span style="display:flex;"><span>    	<span style="color:#ff79c6">if</span> (type.<span style="color:#50fa7b">isEnumType</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> factory.<span style="color:#50fa7b">createEnumDeserializer</span>(ctxt, type, beanDesc);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    	<span style="color:#6272a4">// 判断是否为容器类型，如集合，数组，哈希表等</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (type.<span style="color:#50fa7b">isContainerType</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (type.<span style="color:#50fa7b">isArrayType</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (type.<span style="color:#50fa7b">isMapLikeType</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">if</span> (type.<span style="color:#50fa7b">isCollectionLikeType</span>()) {
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    	<span style="color:#6272a4">// 判断是否为 ReferenceType 的子类</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (type.<span style="color:#50fa7b">isReferenceType</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    	<span style="color:#6272a4">// 判断是否为 JSON 节点</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (JsonNode.<span style="color:#50fa7b">class</span>.<span style="color:#50fa7b">isAssignableFrom</span>(type.<span style="color:#50fa7b">getRawClass</span>())) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    	<span style="color:#6272a4">// 创建 Bean 的反序列化器</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> factory.<span style="color:#50fa7b">createBeanDeserializer</span>(ctxt, type, beanDesc);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserbeandeserializerfactorycreatebeandeserializer"><code>com.fasterxml.jackson.databind.deser.BeanDeserializerFactory#createBeanDeserializer</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>	<span style="color:#6272a4">/**
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	方法，DeserializerCaches调用该方法为集合、映射、数组和枚举以外的类型创建新的反序列化程序
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">	*/</span>
</span></span><span style="display:flex;"><span>	@SuppressWarnings(<span style="color:#f1fa8c">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">createBeanDeserializer</span>(DeserializationContext ctxt,
</span></span><span style="display:flex;"><span>            JavaType type, BeanDescription beanDesc)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">throws</span> JsonMappingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">final</span> DeserializationConfig config <span style="color:#ff79c6">=</span> ctxt.<span style="color:#50fa7b">getConfig</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 首先：我们也可能有自定义覆盖：</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 查找自定义的反序列化器</span>
</span></span><span style="display:flex;"><span>        JsonDeserializer<span style="color:#ff79c6">&lt;?&gt;</span> deser <span style="color:#ff79c6">=</span> _findCustomBeanDeserializer(type, config, beanDesc);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (deser <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> (JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span>) deser;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 还有一件事需要检查：我们是否有异常类型（Throwable或其子类）？如果是这样，需要稍微不同的处理。</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (type.<span style="color:#50fa7b">isThrowable</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// Or, for abstract types, may have alternate means for resolution</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// (defaulting, materialization)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 29-Nov-2015, tatu: Also, filter out calls to primitive types, they are</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//    not something we could materialize anything for</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 或者是 抽象的、基本的、枚举的 类型</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (type.<span style="color:#50fa7b">isAbstract</span>() <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!</span>type.<span style="color:#50fa7b">isPrimitive</span>() <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!</span>type.<span style="color:#50fa7b">isEnumType</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 否则，可能需要从超类检查标准类型的处理程序：</span>
</span></span><span style="display:flex;"><span>        deser <span style="color:#ff79c6">=</span> findStdDeserializer(ctxt, type, beanDesc);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (deser <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 否则：该类是否可以是 Bean 类？如不是，则返回 null</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>isPotentialBeanType(type.<span style="color:#50fa7b">getRawClass</span>())) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 05-May-2020, tatu: [databind#2683] Let&#39;s actually pre-emptively catch</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//   certain types (for now, java.time.*) to give better error messages</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 找到不支持的类型反序列化程序</span>
</span></span><span style="display:flex;"><span>        deser <span style="color:#ff79c6">=</span> _findUnsupportedTypeDeserializer(ctxt, type, beanDesc);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (deser <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 使用泛型bean内省构建反序列化程序</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> buildBeanDeserializer(ctxt, type, beanDesc);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserbeandeserializerfactorybuildbeandeserializer"><code>com.fasterxml.jackson.databind.deser.BeanDeserializerFactory#buildBeanDeserializer</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@SuppressWarnings(<span style="color:#f1fa8c">&#34;unchecked&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">buildBeanDeserializer</span>(DeserializationContext ctxt,
</span></span><span style="display:flex;"><span>            JavaType type, BeanDescription beanDesc)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">throws</span> JsonMappingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// First: check what creators we can use, if any</span>
</span></span><span style="display:flex;"><span>        ValueInstantiator valueInstantiator;
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">/* 04-Jun-2015, tatu: To work around [databind#636], need to catch the
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         *    issue, defer; this seems like a reasonable good place for now.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         *   Note, however, that for non-Bean types (Collections, Maps) this
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         *   probably won&#39;t work and needs to be added elsewhere.
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">         */</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">try</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 找到值实例化器</span>
</span></span><span style="display:flex;"><span>            valueInstantiator <span style="color:#ff79c6">=</span> findValueInstantiator(ctxt, beanDesc);
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">catch</span> (NoClassDefFoundError error) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> ErrorThrowingDeserializer(error);
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">catch</span> (IllegalArgumentException e0) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 05-Apr-2017, tatu: Although it might appear cleaner to require collector</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//   to throw proper exception, it doesn&#39;t actually have reference to this</span>
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//   instance so...</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">throw</span> InvalidDefinitionException.<span style="color:#50fa7b">from</span>(ctxt.<span style="color:#50fa7b">getParser</span>(),
</span></span><span style="display:flex;"><span>                    ClassUtil.<span style="color:#50fa7b">exceptionMessage</span>(e0),
</span></span><span style="display:flex;"><span>                   beanDesc, <span style="color:#ff79c6">null</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">withCause</span>(e0);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        BeanDeserializerBuilder builder <span style="color:#ff79c6">=</span> constructBeanDeserializerBuilder(ctxt, beanDesc);
</span></span><span style="display:flex;"><span>        builder.<span style="color:#50fa7b">setValueInstantiator</span>(valueInstantiator);
</span></span><span style="display:flex;"><span>         <span style="color:#6272a4">// And then setters for deserializing from JSON Object</span>
</span></span><span style="display:flex;"><span>        addBeanProps(ctxt, beanDesc, builder);
</span></span><span style="display:flex;"><span>        addObjectIdReader(ctxt, beanDesc, builder);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// managed/back reference fields/setters need special handling... first part</span>
</span></span><span style="display:flex;"><span>        addBackReferenceProperties(ctxt, beanDesc, builder);
</span></span><span style="display:flex;"><span>        addInjectables(ctxt, beanDesc, builder);
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">final</span> DeserializationConfig config <span style="color:#ff79c6">=</span> ctxt.<span style="color:#50fa7b">getConfig</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (_factoryConfig.<span style="color:#50fa7b">hasDeserializerModifiers</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">for</span> (BeanDeserializerModifier mod : _factoryConfig.<span style="color:#50fa7b">deserializerModifiers</span>()) {
</span></span><span style="display:flex;"><span>                builder <span style="color:#ff79c6">=</span> mod.<span style="color:#50fa7b">updateBuilder</span>(config, beanDesc, builder);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        JsonDeserializer<span style="color:#ff79c6">&lt;?&gt;</span> deserializer;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (type.<span style="color:#50fa7b">isAbstract</span>() <span style="color:#ff79c6">&amp;&amp;</span> <span style="color:#ff79c6">!</span>valueInstantiator.<span style="color:#50fa7b">canInstantiate</span>()) {
</span></span><span style="display:flex;"><span>            deserializer <span style="color:#ff79c6">=</span> builder.<span style="color:#50fa7b">buildAbstract</span>();
</span></span><span style="display:flex;"><span>        } <span style="color:#ff79c6">else</span> {
</span></span><span style="display:flex;"><span>            deserializer <span style="color:#ff79c6">=</span> builder.<span style="color:#50fa7b">build</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// may have modifier(s) that wants to modify or replace serializer we just built</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// (note that `resolve()` and `createContextual()` called later on)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (_factoryConfig.<span style="color:#50fa7b">hasDeserializerModifiers</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">for</span> (BeanDeserializerModifier mod : _factoryConfig.<span style="color:#50fa7b">deserializerModifiers</span>()) {
</span></span><span style="display:flex;"><span>                deserializer <span style="color:#ff79c6">=</span> mod.<span style="color:#50fa7b">modifyDeserializer</span>(config, beanDesc, deserializer);
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> (JsonDeserializer<span style="color:#ff79c6">&lt;</span>Object<span style="color:#ff79c6">&gt;</span>) deserializer;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserbasicdeserializerfactoryfindvalueinstantiator"><code>com.fasterxml.jackson.databind.deser.BasicDeserializerFactory#findValueInstantiator</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> ValueInstantiator <span style="color:#50fa7b">findValueInstantiator</span>(DeserializationContext ctxt,
</span></span><span style="display:flex;"><span>            BeanDescription beanDesc)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">throws</span> JsonMappingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">final</span> DeserializationConfig config <span style="color:#ff79c6">=</span> ctxt.<span style="color:#50fa7b">getConfig</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        ValueInstantiator instantiator <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//...</span>
</span></span><span style="display:flex;"><span>        		<span style="color:#6272a4">// 创建默认的值实例化器</span>
</span></span><span style="display:flex;"><span>                instantiator <span style="color:#ff79c6">=</span> _constructDefaultValueInstantiator(ctxt, beanDesc);
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// finally: anyone want to modify ValueInstantiator?</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (_factoryConfig.<span style="color:#50fa7b">hasValueInstantiators</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">for</span> (ValueInstantiators insts : _factoryConfig.<span style="color:#50fa7b">valueInstantiators</span>()) {
</span></span><span style="display:flex;"><span>                instantiator <span style="color:#ff79c6">=</span> insts.<span style="color:#50fa7b">findValueInstantiator</span>(config, beanDesc, instantiator);
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// let&#39;s do sanity check; easier to spot buggy handlers</span>
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">if</span> (instantiator <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>                    ctxt.<span style="color:#50fa7b">reportBadTypeDefinition</span>(beanDesc,
</span></span><span style="display:flex;"><span>						<span style="color:#f1fa8c">&#34;Broken registered ValueInstantiators (of type %s): returned null ValueInstantiator&#34;</span>,
</span></span><span style="display:flex;"><span>						insts.<span style="color:#50fa7b">getClass</span>().<span style="color:#50fa7b">getName</span>());
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (instantiator <span style="color:#ff79c6">!=</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            instantiator <span style="color:#ff79c6">=</span> instantiator.<span style="color:#50fa7b">createContextual</span>(ctxt, beanDesc);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> instantiator;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserbasicdeserializerfactory_constructdefaultvalueinstantiator"><code>com.fasterxml.jackson.databind.deser.BasicDeserializerFactory#_constructDefaultValueInstantiator</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">protected</span> ValueInstantiator <span style="color:#50fa7b">_constructDefaultValueInstantiator</span>(DeserializationContext ctxt,
</span></span><span style="display:flex;"><span>            BeanDescription beanDesc)
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">throws</span> JsonMappingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">final</span> CreatorCollectionState ccState;
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd;font-style:italic">final</span> ConstructorDetector ctorDetector;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//...</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 从属性值查找创建者（不懂）</span>
</span></span><span style="display:flex;"><span>            Map<span style="color:#ff79c6">&lt;</span>AnnotatedWithParams,BeanPropertyDefinition<span style="color:#ff79c6">[]&gt;</span> creatorDefs <span style="color:#ff79c6">=</span> _findCreatorsFromProperties(ctxt,
</span></span><span style="display:flex;"><span>                    beanDesc);
</span></span><span style="display:flex;"><span>           <span style="color:#6272a4">//...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//...</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> ccState.<span style="color:#50fa7b">creators</span>.<span style="color:#50fa7b">constructValueInstantiator</span>(ctxt);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabinddeserbasicdeserializerfactory_findcreatorsfromproperties"><code>com.fasterxml.jackson.databind.deser.BasicDeserializerFactory#_findCreatorsFromProperties</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">protected</span> Map<span style="color:#ff79c6">&lt;</span>AnnotatedWithParams,BeanPropertyDefinition<span style="color:#ff79c6">[]&gt;</span> <span style="color:#50fa7b">_findCreatorsFromProperties</span>(DeserializationContext ctxt,
</span></span><span style="display:flex;"><span>            BeanDescription beanDesc) <span style="color:#8be9fd;font-style:italic">throws</span> JsonMappingException
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        Map<span style="color:#ff79c6">&lt;</span>AnnotatedWithParams,BeanPropertyDefinition<span style="color:#ff79c6">[]&gt;</span> result <span style="color:#ff79c6">=</span> Collections.<span style="color:#50fa7b">emptyMap</span>();
</span></span><span style="display:flex;"><span>    	<span style="color:#6272a4">// 查找所有属性</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">for</span> (BeanPropertyDefinition propDef : beanDesc.<span style="color:#50fa7b">findProperties</span>()) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">//...</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> result;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabindintrospectbasicbeandescriptionfindproperties"><code>com.fasterxml.jackson.databind.introspect.BasicBeanDescription#findProperties</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> List<span style="color:#ff79c6">&lt;</span>BeanPropertyDefinition<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">findProperties</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> _properties();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabindintrospectbasicbeandescription_properties"><code>com.fasterxml.jackson.databind.introspect.BasicBeanDescription#_properties</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">protected</span> List<span style="color:#ff79c6">&lt;</span>BeanPropertyDefinition<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">_properties</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (_properties <span style="color:#ff79c6">==</span> <span style="color:#ff79c6">null</span>) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 为空则创建</span>
</span></span><span style="display:flex;"><span>            _properties <span style="color:#ff79c6">=</span> _propCollector.<span style="color:#50fa7b">getProperties</span>();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> _properties;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabindintrospectpojopropertiescollectorgetproperties"><code>com.fasterxml.jackson.databind.introspect.POJOPropertiesCollector#getProperties</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> List<span style="color:#ff79c6">&lt;</span>BeanPropertyDefinition<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">getProperties</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 确保我们返回一个副本，以便调用方可以在需要时删除条目：</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 获取所有属性</span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#ff79c6">&lt;</span>String, POJOPropertyBuilder<span style="color:#ff79c6">&gt;</span> props <span style="color:#ff79c6">=</span> getPropertyMap();
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> ArrayList<span style="color:#ff79c6">&lt;</span>BeanPropertyDefinition<span style="color:#ff79c6">&gt;</span>(props.<span style="color:#50fa7b">values</span>());
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabindintrospectpojopropertiescollectorgetpropertymap"><code>com.fasterxml.jackson.databind.introspect.POJOPropertiesCollector#getPropertyMap</code></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">protected</span> Map<span style="color:#ff79c6">&lt;</span>String, POJOPropertyBuilder<span style="color:#ff79c6">&gt;</span> <span style="color:#50fa7b">getPropertyMap</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>_collected) {
</span></span><span style="display:flex;"><span>            <span style="color:#6272a4">// 收集所有属性</span>
</span></span><span style="display:flex;"><span>            collectAll();
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> _properties;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="comfasterxmljacksondatabindintrospectpojopropertiescollectorcollectall"><code>com.fasterxml.jackson.databind.introspect.POJOPropertiesCollector#collectAll</code></h3>
<p>重点到了</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">protected</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">collectAll</span>()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        LinkedHashMap<span style="color:#ff79c6">&lt;</span>String, POJOPropertyBuilder<span style="color:#ff79c6">&gt;</span> props <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> LinkedHashMap<span style="color:#ff79c6">&lt;</span>String, POJOPropertyBuilder<span style="color:#ff79c6">&gt;</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 第一：收集基础数据</span>
</span></span><span style="display:flex;"><span>    	<span style="color:#6272a4">// 收集字段</span>
</span></span><span style="display:flex;"><span>        _addFields(props); <span style="color:#6272a4">// 注意：填充_fieldRenameMappings</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 收集方法，如果是 getter setter 方法则会根据其方法规则设置对应的属性</span>
</span></span><span style="display:flex;"><span>    	_addMethods(props);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 25-Jan-2016, tatu: Avoid introspecting (constructor-)creators for non-static</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">//    inner classes, see [databind#1502]</span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">if</span> (<span style="color:#ff79c6">!</span>_classDef.<span style="color:#50fa7b">isNonStaticInnerClass</span>()) {
</span></span><span style="display:flex;"><span>            _addCreators(props);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// Remove ignored properties, first; this MUST precede annotation merging</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// since logic relies on knowing exactly which accessor has which annotation</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// 移除不需要的属性</span>
</span></span><span style="display:flex;"><span>    	<span style="color:#6272a4">/*
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    		注：里面会移除掉不可见的属性，也就是说 private 的属性方法都会被移除。所以字段名称实际上以通过解析 getter setter 方法得出的名称为准
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4">    	*/</span>
</span></span><span style="display:flex;"><span>    	_removeUnwantedProperties(props);
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// ...</span>
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>获取属性到这里差不多就结束了。</p>


                

                
                <hr>
                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/7224237482966319108/" data-toggle="tooltip" data-placement="top" title="@SuppressWarnings 注解">&larr;
                            Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/7224237482966319107/" data-toggle="tooltip" data-placement="top" title="从0到N搭建微服务项目">Next
                            Post &rarr;</a>
                    </li>
                    
                </ul>
                

                


            </div>

            
            
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
            

            
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
                        
                        
                        
                        
                        
                        <a href="/tags/debian" title="debian">
                            debian
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/java%E5%9F%BA%E7%A1%80" title="java基础">
                            java基础
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/kubernetes" title="kubernetes">
                            kubernetes
                        </a>
                        
                        
                        
                        <a href="/tags/leetcode" title="leetcode">
                            leetcode
                        </a>
                        
                        
                        
                        <a href="/tags/linux" title="linux">
                            linux
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/mysql" title="mysql">
                            mysql
                        </a>
                        
                        
                        
                        <a href="/tags/springboot" title="springboot">
                            springboot
                        </a>
                        
                        
                        
                        <a href="/tags/springboot" title="springboot&#39;">
                            springboot&#39;
                        </a>
                        
                        
                        
                        <a href="/tags/springcloud" title="springcloud">
                            springcloud
                        </a>
                        
                        
                        
                        <a href="/tags/ssm" title="ssm">
                            ssm
                        </a>
                        
                        
                        
                        <a href="/tags/tools" title="tools">
                            tools
                        </a>
                        
                        
                        
                        <a href="/tags/top" title="top">
                            top
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E6%A0%91" title="树">
                            树
                        </a>
                        
                        
                        
                        
                        
                        <a href="/tags/%E7%A7%81%E6%9C%89%E5%B1%80%E5%9F%9F%E7%BD%91%E6%90%AD%E5%BB%BA%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83" title="私有局域网搭建开发环境">
                            私有局域网搭建开发环境
                        </a>
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        
                        <a href="/tags/%E9%98%85%E8%AF%BB%E7%AC%94%E8%AE%B0" title="阅读笔记">
                            阅读笔记
                        </a>
                        
                        
                        
                        
                    </div>
                </section>
                

                
                
                <section>
                    <hr>
                    <h5>FRIENDS</h5>
                    <ul class="list-inline">
                        
                        <li><a target="_blank" href="https://zrgzs.github.io/guide">ZRGZS 的博客</a></li>
                        
                    </ul>
                </section>
                
            </div>
        </div>
    </div>
</article>




<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">                  
                    
                    <li>
                        <a href="mailto:xfdzcoder@gmail.com">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		           
                    
                    
                    
                    

		            
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/xfdzcoder">
                            <span class="fa-stack fa-lg">
                                <i class="fas fa-circle fa-stack-2x"></i>
                                <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
		            
                    
                    
                    
                    
                    
                    
                    
                    
                    
            
            
            
           
             </ul>
		<p class="copyright text-muted">
                    Copyright &copy; XFDZ&#39;s Blog 2024
                    
                    <br>
                    <a href="https://themes.gohugo.io/hugo-theme-cleanwhite">CleanWhite Hugo Theme</a> by <a href="https://zhaohuabing.com">Huabing</a> |
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="100px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=zhaohuabing&repo=hugo-theme-cleanwhite&type=star&count=true" >
                    </iframe>
                    
                </p>
            </div>
        </div>
    </div>
</footer>




<script>
    function loadAsync(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>






<script>
    
    if($('#tag_cloud').length !== 0){
        loadAsync("/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>


<script>
    loadAsync("https://cdn.jsdelivr.net/npm/fastclick@1.0.6/lib/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>






<script type="text/javascript">
    function generateCatalog(selector) {

        
        
        
        
            _containerSelector = 'div.post-container'
        

        
        var P = $(_containerSelector), a, n, t, l, i, c;
        a = P.find('h1,h2,h3,h4,h5,h6');

        
        $(selector).html('')

        
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#" + $(this).prop('id');
            t = $(this).text();
            c = $('<a href="' + i + '" rel="nofollow">' + t + '</a>');
            l = $('<li class="' + n + '_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;
    }

    generateCatalog(".catalog-body");

    
    $(".catalog-toggle").click((function (e) {
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    


    loadAsync("\/js\/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>






</html>
