---
url: /7224246078978457601
title: 'mysql中datadir目录下的文件'
date: 2024-07-19T09:52:52+08:00
draft: false
summary: 'MySQL5和8中的数据库目录结构的异同'
categories: [框架]
tags: ['mysql']
---

<hr>

### 目录结构的对比

MySQL8.0 中对 `datadir` 下数据库文件目录结构做了修改。

#### MySQL5.7

（图源：[104-My SQL目录结构与表在文件系统中的表示](https://www.bilibili.com/video/BV1iq4y1u7vj?p=104)）

![image-20240719100212339](https://cdn.jsdelivr.net/gh/zrgzs/images@main/images/2024%2F07%2F19%2F10-02-31-0a5608583903434adc2ad73c1ed4c329-image-20240719100212339-22d05f.png)

#### MySQL8.0

![image-20240719100306015](https://cdn.jsdelivr.net/gh/zrgzs/images@main/images/2024%2F07%2F19%2F10-03-06-fbcb0960e8d6f1c7afa2766b7bc5c775-image-20240719100306015-c8582c.png)

### 目录结构内容详情

#### MySQL5.7

- `db.opt` 文件：存放数据库字符集等信息。
- `xx.frm` 文件：保存表结构。
- `xx.idb` 文件：保存表数据。
  - 扩展阅读：关于MySQL5.6.6（不包括）之前的版本中系统表空间和独立表空间。

#### MySQL8.0

- `xx.idb` 文件：保存表结构和表数据。

### MySQL8.0 中缺少的文件信息去哪了？

#### `xx.frm` 文件

被合并到了 `xx.idb` 文件中，如何查看呢？

使用 MySQL 提供的工具：`ibd2sdi`

示例命令：

```bash
ibd2sdi --dump-file=table_01.txt table_01.ibd
```

#### `db.opt` 文件

通过查阅 MySQL 官方文档：[MySQL :: MySQL 8.0 Reference Manual :: 16.2 Removal of File-based Metadata Storage](https://dev.mysql.com/doc/refman/8.0/en/data-dictionary-file-removal.html)

>## 16.2 Removal of File-based Metadata Storage 
>
>## 16.2 删除基于文件的元数据存储
>
>
>
>In previous MySQL releases, dictionary data was partially stored in metadata files. Issues with file-based metadata storage included expensive file scans, susceptibility to file system-related bugs, complex code for handling of replication and crash recovery failure states, and a lack of extensibility that made it difficult to add metadata for new features and relational objects.
>在以前的 MySQL 版本中，字典数据部分存储在元数据文件中。基于文件的元数据存储的问题包括昂贵的文件扫描、对文件系统相关错误的敏感性、用于处理复制和崩溃恢复故障状态的复杂代码，以及缺乏可扩展性，导致难以为新功能和关系对象添加元数据。
>
>The metadata files listed below are removed from MySQL. Unless otherwise noted, data previously stored in metadata files is now stored in data dictionary tables.
>下面列出的元数据文件已从 MySQL 中删除。除非另有说明，之前存储在元数据文件中的数据现在存储在数据字典表中。
>
>- `.frm` files: Table metadata files. With the removal of `.frm` files:
>  .frm`文件：表元数据文件。删除`.frm`文件：`
>  - The 64KB table definition size limit imposed by the `.frm` file structure is removed.
>    `.frm` 施加的 64KB 表定义大小限制文件结构被删除。
>  - The Information Schema [`TABLES`](https://dev.mysql.com/doc/refman/8.0/en/information-schema-tables-table.html) table's `VERSION` column reports a hardcoded value of `10`, which is the last `.frm` file version used in MySQL 5.7.
>    信息模式[`表格`](https://dev.mysql.com/doc/refman/8.0/en/information-schema-tables-table.html) 表的`版本`列报告硬编码值 `10`，这是最后一个 `.frm` MySQL 5.7 中使用的文件版本。
>- `.par` files: Partition definition files. `InnoDB` stopped using partition definition files in MySQL 5.7 with the introduction of native partitioning support for `InnoDB` tables.
>  .par` files：分区定义文件。 `InnoDB`随着对 `InnoDB` 的本机分区支持的引入，MySQL 5.7 中停止使用分区定义文件表。`
>- `.TRN` files: Trigger namespace files.
>  .TRN` files：触发命名空间文件。`
>- `.TRG` files: Trigger parameter files.
>  .TRG`文件：触发参数文件。`
>- `.isl` files: `InnoDB` Symbolic Link files containing the location of [file-per-table](https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_file_per_table) tablespace files created outside of the data directory.
>  .isl`文件：`InnoDB` 包含 `file-per-table[ 位置的符号链接文件 在数据目录之外创建的表空间文件。](https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_file_per_table)
>- `db.opt` files: Database configuration files. These files, one per database directory, contained database default character set attributes.
>  db.opt`文件：数据库配置文件。这些文件（每个数据库目录一个）包含数据库默认字符集属性。`
>- `ddl_log.log` file: The file contained records of metadata operations generated by data definition statements such as [`DROP TABLE`](https://dev.mysql.com/doc/refman/8.0/en/drop-table.html) and [`ALTER TABLE`](https://dev.mysql.com/doc/refman/8.0/en/alter-table.html).
>  ddl_log.log`文件：该文件包含由数据定义语句（例如`DROP TABLE[`）生成的元数据操作的记录。 和`](https://dev.mysql.com/doc/refman/8.0/en/drop-table.html)更改表[`。`](https://dev.mysql.com/doc/refman/8.0/en/alter-table.html)

可知，其内容被保存到了数据字典表中。

扩展阅读：[MySQL :: MySQL 8.0 Reference Manual :: 7.3 The mysql System Schema](https://dev.mysql.com/doc/refman/8.0/en/system-schema.html#system-schema-data-dictionary-tables)

